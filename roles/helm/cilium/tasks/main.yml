---
- name: add helm repository for celium
  kubernetes.core.helm_repository:
    name: cilium
    repo_url: https://helm.cilium.io/

- name: helm install cilium
  kubernetes.core.helm:
    name: cilium
    chart_ref: cilium/cilium 
    chart_version: 1.11.5
    release_namespace: kube-system
    values:
      k8sServiceHost: 10.8.0.1
      k8sServicePort: 6443
      hubble:
        relay:
          enabled: true
        ui:
          enabled: true
      ipam:
        # -- Configure IP Address Management mode.
        # ref: https://docs.cilium.io/en/stable/concepts/networking/ipam/
        mode: "cluster-pool"
        operator:
          # -- Deprecated in favor of ipam.operator.clusterPoolIPv4PodCIDRList.
          # IPv4 CIDR range to delegate to individual nodes for IPAM.
          clusterPoolIPv4PodCIDR: "10.99.0.0/8"
