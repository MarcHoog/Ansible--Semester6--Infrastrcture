---
- name: setting up kea server
  hosts: kea
  tasks:
    - name: Importing kea role
      include_role:
          name: kea
      vars:
        kea_dhcp4:
          Dhcp4:
            renew-timer: 1000
            rebind-timer: 2000

            dhcp-ddns:
              enable-updates: true
              server-ip: 127.0.0.1
              serverport: 53001
              sender-ip: ""
              sender-port: 0
              max-queue-size: 1024
              ncr-protocol: "UDP"
              ncr-format: "JSON"

            ddns-send-updates": true,
            ddns-override-no-update": true
            ddns-override-client-update": false
            ddns-replace-client-name": "never"
            ddns-generated-prefix": ""
            ddns-qualifying-suffix": ""
            ddns-update-on-renew": false,
            ddns-use-conflict-resolution": true,
            hostname-char-set": ""
            hostname-char-replacement": ""

            
            # Add names of interfaces to listen on
            interfaces-config:
              interfaces:
                - "*"
                # - eth0
                # - eth1
              dhcp-socket-type: raw
            
            # Use Memfile lease database backend to store leases in a CSV file.
            lease-database:
              type: memfile
              persist: true
              lfc-interval: 0
            
            # Setup reclamation of the expired leases and leases affinity.
            expired-leases-processing:
              reclaim-timer-wait-time: 10
              flush-reclaimed-timer-wait-time: 25
              hold-reclaimed-time: 3600
              max-reclaim-leases: 100
              max-reclaim-time: 250
              unwarned-reclaim-cycles: 5
              
            # Global (inherited by all subnets) lease lifetime is mandatory parameter.
            valid-lifetime: 4000
            
            # Below an example of the simple subnet declarations
            subnet4:
              - subnet: 10.0.0.0/24
                pools:
                  - pool: 10.0.0.50 - 10.0.0.200
                option-data:
                  - name: routers
                    data: "10.0.0.254"
                  - name: domain-name-servers
                    data: "10.0.0.1"
                  - name: domain-name
                    data: "lab.mylocal"
                user-context:
                  note: Service network

              - subnet: 10.8.0.1/24
                pools:
                  - pool: 10.8.0.10 - 10.8.0.200
                option-data:
                  - name: routers
                    data: "10.8.0.254"
                  - name: domain-name-servers
                    data: "10.8.0.254"
                  - name: domain-name
                    data: "lab.mylocal"
                user-context:
                  note: Kubernetes network

              - subnet: 10.254.0.0/24
                pools:
                  - pool: 10.254.0.5 - 10.254.0.200
                option-data:
                  - name: routers
                    data: "10.254.0.254"
                  - name: domain-name-servers
                    data: "10.254.0.254"
                  - name: domain-name
                    data: "lab.mylocal"
                user-context:
                  note: Personal network
        
        kea_dhcp_ddns:
          DhcpDdns:
            ip-address: 127.0.0.1
            port: 53001
            dns-server-timeout: 100
            ncr-protocol: "UDP"
            ncr-format: "JSON"
            tsig-keys: []
            forward-ddns: 
                ddns-domains:
                  - name: "lab.mylocal"
                    dns-servers:
                      - ip-address: 10.0.0.10
                        port: 53
            reverse-ddns:
              ddns-domains:
                - name: "10.in-addr-arpa."
                  dns-servers:
                      - ip-address: 10.0.0.10
                        port: 53